<!DOCTYPE html>
<html>
<head>
    <title>INMP441 Precise Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #050505; color: #00ff41; font-family: 'Courier New', monospace; text-align: center; }
        .info { color: #00ccff; margin-bottom: 10px; font-size: 0.9em; }
        canvas { max-width: 95%; margin: auto; border: 1px solid #222; }
    </style>
</head>
<body>
    <h1>SPECTRE FFT CALIBRÃ‰ (dBFS)</h1>
    <div class="info">48kHz | 11.7Hz/bin | HPF 60Hz-15kHz</div>
    <canvas id="chart"></canvas>

    <script>
        const ctx = document.getElementById('chart').getContext('2d');
        let chart;

        async function start() {
            const res = await fetch('/data');
            const init = await res.json();

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: init.labels,
                    datasets: [{
                        label: 'Niveau (dBFS)',
                        data: init.db,
                        borderColor: '#00ff41',
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    animation: false,
                    scales: {
                        x: { 
                            type: 'logarithmic', 
                            min: 50, 
                            max: 18000,
                            ticks: { color: '#00ff41' },
                            grid: { color: '#111' }
                        },
                        y: { 
                            min: -100, 
                            max: 0,
                            ticks: { color: '#00ff41' },
                            grid: { color: '#222' }
                        }
                    }
                }
            });
            refresh();
        }

        async function refresh() {
            try {
                const response = await fetch('/data');
                const d = await response.json();
                chart.data.datasets[0].data = d.db;
                chart.update('none');
            } catch(e) {}
            requestAnimationFrame(refresh);
        }
        start();
    </script>
</body>
</html>